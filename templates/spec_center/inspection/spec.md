# inspection｜安全检查（spec）

## 1) Why（为什么做）
- 标准化检查任务执行过程，确保检查记录完整、可追溯。
- 缩短检查问题发现到处置的闭环周期。
- 为监管报表与风险评估提供结构化检查数据。

## 2) What（做什么）

### 2.1 能力范围（In Scope）
- 检查任务查询（分页、筛选、状态）。
- 检查任务执行与结果记录（通过/不通过）。
- 检查项明细维护与问题记录。
- 结果导出与基础统计。

### 2.2 非范围（Out of Scope）
- 智能巡检设备数据直连（后续迭代）。
- 复杂评分模型（后续迭代）。

## 3) 用户与场景（Who / Scenarios）
- 检查员：执行检查并提交结果。
- 主管：查看任务进度与不通过项。
- 审核员：复核关键检查结果。

关键场景：
- 当日检查任务按计划完成并可追踪。
- 不通过项可快速定位并创建后续整改。

## 4) 业务规则（Rules）
- 检查任务关闭前必须有完整检查记录。
- 不通过项必须填写问题描述与处置建议。
- 检查结论变更需保留审计轨迹（人/时间/原因）。

## 5) API / Contract 影响
- 影响契约文件：`inspection/contracts/openapi.yaml`
- 典型 endpoint（示例）：
  - `GET /api/inspections`
  - `GET /api/inspections/{id}`
  - `POST /api/inspections/{id}/submit`
  - `POST /api/inspections/{id}/recheck`
- 兼容策略：
  - 新增字段保持向后兼容。
  - 破坏性变更必须在 PR 标注并给迁移方案。

## 6) 数据与迁移影响（可选）
- 是否涉及 DB 结构变更：否（示例）
- 若涉及：
  - 明确迁移脚本与回滚路径
  - 说明历史数据兼容策略

## 7) DoD（完成定义）
- [ ] spec 与 `openapi.yaml` 已同步
- [ ] capability-registry 已更新能力与同义词
- [ ] 关键场景最小回归通过
- [ ] PR 风险与回滚说明完整

## 8) 风险与回滚
- 主要风险：检查状态与结果字段不一致。
- 监控点：任务完成率、不通过项数量、接口错误率。
- 回滚策略：按版本回退并保留关键审计数据。

## 9) 外部依赖（若有）
- 第三方契约存放：`_raw_contracts/external/<vendor>/openapi.yaml`
- 外部系统仅作为依赖输入，不作为本 spec 主体。
